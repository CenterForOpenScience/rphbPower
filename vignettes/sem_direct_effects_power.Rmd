---
title: "SEM Direct Effects Power Analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SEM Direct Effects Power Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(rphbPower)
```

Power analysis for direct effects in structural equation models using partial correlations within the unified framework. Standardized path coefficients in SEM are mathematically equivalent to partial correlations, enabling seamless framework integration.

## Overview

SEM direct effects represent hypothesized causal relationships in structural equation models. This extends the unified framework to complex latent variable models while maintaining partial correlation consistency. The key insight: standardized path coefficients ARE partial correlations in structural contexts.

## Key Framework Features

- **Unified Effect Size Metric**: All path coefficients use partial correlations for direct comparison
- **Automatic Parameter Detection**: Provide any two of (r_partial, n, power) - the third is calculated
- **Conservative Planning**: Built-in discount factor (default 0.75) for realistic estimates
- **Framework Integration**: Seamless conversion from Cohen's d, f², R² with structural complexity adjustments
- **Measurement Reliability**: Proper attenuation correction for latent variable contexts

## Quick Start

```r
library(rphbPower)

# Calculate power (provide path coefficient and sample size)
sem_direct_effects_power(r_partial = 0.25, n = 400, n_predictors = 4)

# Calculate sample size (provide path coefficient and power)
sem_direct_effects_power(r_partial = 0.20, power = 0.8, n_predictors = 5)

# Calculate effect size (provide sample size and power)
sem_direct_effects_power(n = 500, power = 0.8, n_predictors = 3)

# Framework integration (automatic conversion and structural adjustments)
sem_direct_effects_framework_power(effect_size = 0.5, effect_type = "d", power = 0.8, n_predictors = 4)
```

## Main Functions

### `sem_direct_effects_power()`
Core power analysis with framework integration.

**Parameters:**

- `r_partial`: Standardized path coefficient as partial correlation (NULL to calculate)
- `n`: Sample size (NULL to calculate)
- `power`: Statistical power (NULL to calculate, default = 0.8)
- `n_predictors`: Number of predictors of the dependent variable (default = 3)
- `alpha`: Significance level (default = 0.05)
- `discount_factor`: Conservative discount factor (default = 0.75)
- `measurement_reliability`: Average reliability of measures (default = 0.85)
- `effect_input`: Raw effect size input (alternative to r_partial)
- `effect_type`: Type of effect_input ("r", "d", "f2", "r_squared", "eta_squared")

### `sem_direct_effects_framework_power()`
Framework-integrated analysis with automatic conversion.

**Parameters:**

- `effect_size`: Effect size value
- `effect_type`: Type of effect size ("r", "d", "f2", "r_squared", "eta_squared")
- `n`: Sample size (NULL to calculate)
- `power`: Target power (default = 0.8)
- `n_predictors`: Number of predictors

### Convenience Functions

- `sem_direct_effects_sample_size()`: Quick sample size calculation
- `sem_direct_effects_power_check()`: Quick power calculation

## Framework Integration Examples

### Multiple Effect Size Types
```r
# Cohen's d to framework SEM
sem_direct_effects_framework_power(effect_size = 0.5, effect_type = "d", power = 0.8, n_predictors = 4)

# f² to framework SEM
sem_direct_effects_framework_power(effect_size = 0.15, effect_type = "f2", n = 400, n_predictors = 5)

# Direct partial correlation (path coefficient)
sem_direct_effects_power(r_partial = 0.25, power = 0.8, n_predictors = 3)
```

### Literature Integration
```r
# Convert mixed literature effects to unified framework
effect_sizes <- c(0.25, 0.4, 0.15)    # r, Cohen's d, f²
effect_types <- c("r", "d", "f2")

# Framework conversion workflow using individual conversions
framework_rs <- sapply(1:length(effect_sizes), function(i) {
  framework_effect_size(effect_sizes[i], effect_types[i], apply_discount = TRUE)
})
```

## Effect Size Guidelines

### Framework Interpretation (Cohen's Standard)

- **r < 0.10**: Negligible direct effect
- **r = 0.10-0.29**: Small direct effect
- **r = 0.30-0.49**: Medium direct effect
- **r ≥ 0.50**: Large direct effect

### Field-Specific Planning (Cohen's d equivalents)

- **Psychology**: d = 0.4 (r ≈ 0.15 after discount)
- **Education**: d = 0.5 (r ≈ 0.19 after discount)
- **Health**: d = 0.35 (r ≈ 0.13 after discount)
- **Marketing**: d = 0.45 (r ≈ 0.17 after discount)

## Sample Size Planning

Use framework power analysis functions to determine sample size requirements for your specific SEM design. SEM typically requires larger samples than single-level regression due to structural complexity:

```r
# Calculate required sample size for your design
sem_direct_effects_power(r_partial = 0.25, power = 0.8, n_predictors = 4)

# Compare with simpler regression requirements
linear_regression_power(r_partial = 0.25, power = 0.8, n_predictors = 4)
```

## Best Practices

### Framework Workflow

1. **Use framework functions** for all effect size conversions
2. **Apply default discount factor** (0.75) for conservative planning
3. **Leverage auto-detection** by providing any 2 of 3 parameters
4. **Account for structural complexity** through SEM-specific adjustments

### Study Planning

1. **Literature Integration**: Convert all effect sizes to partial correlations
2. **Structural Complexity**: Account for SEM's additional complexity beyond regression
3. **Measurement Quality**: High reliability crucial for stable path estimates
4. **Conservative Estimates**: Trust framework discount for realistic planning

### Quality Assurance

1. **Framework Validation**: All inputs validated by core utilities
2. **Mathematical Accuracy**: Proper F-distribution calculations with structural adjustments
3. **Consistent Interpretation**: Standard Cohen's effect size guidelines
4. **Cross-method Comparison**: Direct comparison with regression, correlation results

## Integration with Unified Framework

### Framework Functions Used

- `framework_effect_size()`: Unified effect size conversion
- `validate_partial_r()`: Input validation for path coefficients
- `framework_conversion_summary()`: Complete effect size reports
- `partial_r_to_cohens_f2()`: Framework-consistent conversions

### Package Integration
This SEM analysis integrates seamlessly with all other framework methods:

- **Linear Regression**: Path coefficients equivalent to regression coefficients with structural complexity
- **Correlation Analysis**: Simple paths reduce to correlations with SEM context
- **Mediation Analysis**: SEM paths are mediation pathway coefficients
- **Mixed Models**: Unified effect interpretation across structural complexity levels

SEM represents the ultimate demonstration of the unified framework's power - even the most sophisticated multivariate analyses can be understood through consistent partial correlation metrics, enabling researchers to compare structural equation results with simpler analytical approaches while maintaining mathematical rigor and interpretive clarity.

## Examples

Essential scenarios demonstrating SEM direct effects power analysis within the unified framework using partial correlations for standardized path coefficients.

Author: Power Analysis Package
Version: 1.2

### EXAMPLE 1: BASIC FRAMEWORK WORKFLOW

```{r ex1}
# Research: Direct effect in structural model (path coefficient = partial correlation)
# Expected standardized path coefficient: r = 0.25, 4 predictors

result1 <- sem_direct_effects_power(r_partial = 0.25, n = 400, n_predictors = 4, 
                                    measurement_reliability = 0.90)
print(result1)
```

### EXAMPLE 2: SAMPLE SIZE PLANNING WITH FRAMEWORK

```{r ex2}
# Target: 80% power to detect direct effect
# Expected path coefficient: r = 0.20, complex model with 6 predictors

result2 <- sem_direct_effects_power(r_partial = 0.20, power = 0.8, n_predictors = 6, 
                                    measurement_reliability = 0.85)

cat("Sample size needed:", result2$n, ", Effective n:", result2$effective_n, "\n")
```

### EXAMPLE 3: FRAMEWORK EFFECT SIZE CONVERSIONS

```{r ex3}
# Convert Cohen's d = 0.5 to framework SEM analysis

result3 <- sem_direct_effects_framework_power(
  effect_size = 0.5,
  effect_type = "d",
  power = 0.8,
  n_predictors = 5
)

cat("Cohen's d = 0.5 → Framework path coefficient:", round(result3$r_partial, 3),
    ", Required n:", result3$n, "\n")
```

### EXAMPLE 4: MEASUREMENT RELIABILITY IMPACT

```{r ex4}
# Fixed path coefficient, varying measurement reliability

r_fixed <- 0.25
n_fixed <- 400
predictors_fixed <- 4

cat("Measurement reliability impact (r = 0.25, n = 400, 4 predictors):\n")
for (reliability in c(0.70, 0.80, 0.90, 0.95)) {
  power_achieved <- sem_direct_effects_power(r_partial = r_fixed, n = n_fixed, 
                                             n_predictors = predictors_fixed,
                                             measurement_reliability = reliability)$power
  cat("Reliability =", reliability, ": Power =", round(power_achieved, 3), "\n")
}
```

### EXAMPLE 5: MODEL COMPLEXITY COMPARISON

```{r ex5}
# Understanding how model complexity affects power

r_complex <- 0.20
n_complex <- 400

cat("Model complexity impact (r = 0.20, n = 400):\n")
for (n_pred in c(2, 4, 6, 8)) {
  power_result <- sem_direct_effects_power_check(r_partial = r_complex, n = n_complex, 
                                                 n_predictors = n_pred)
  cat("Predictors =", n_pred, ": Power =", round(power_result, 3), "\n")
}
```

### EXAMPLE 6: DETECTABLE EFFECT SIZE ANALYSIS

```{r ex6}
# Study constraints: 500 participants, 5 predictors, want 80% power

result6 <- sem_direct_effects_power(n = 500, power = 0.8, n_predictors = 5)

cat("With n=500, 5 predictors, 80% power detects path coefficient r =", 
    round(result6$r_partial, 3), "\n")
```

### EXAMPLE 7: FIELD-SPECIFIC APPLICATIONS

```{r ex7}
# Typical effect sizes by research field (as Cohen's d equivalents)

fields <- data.frame(
  Field = c("Psychology", "Education", "Health", "Marketing"),
  Effect_d = c(0.4, 0.5, 0.35, 0.45),
  N_predictors = c(4, 5, 6, 3),
  Reliability = c(0.85, 0.90, 0.80, 0.88)
)

cat("Sample sizes for 80% power by field:\n")
for (i in 1:nrow(fields)) {
  field_result <- sem_direct_effects_framework_power(
    effect_size = fields$Effect_d[i],
    effect_type = "d",
    power = 0.8,
    n_predictors = fields$N_predictors[i]
  )
  cat(fields$Field[i], "(d =", fields$Effect_d[i], "):", field_result$n, "participants\n")
}
```

### EXAMPLE 8: CONSERVATIVE VS. OPTIMISTIC PLANNING

```{r ex8}
# Compare framework discount vs. no discount

pilot_path <- 0.35

# Framework approach (with discount)
conservative_result <- sem_direct_effects_framework_power(
  effect_size = pilot_path,
  effect_type = "r",
  power = 0.8,
  n_predictors = 3
)

# No discount approach using manual conversion
optimistic_path <- framework_effect_size(pilot_path, "r", apply_discount = FALSE)
optimistic_result <- sem_direct_effects_power(
  r_partial = optimistic_path,
  power = 0.8,
  n_predictors = 3
)

cat("Planning comparison for path coefficient = 0.35:\n")
cat("Conservative (framework):", conservative_result$n, "vs Optimistic:", optimistic_result$n,
    "- Safety margin:", conservative_result$n - optimistic_result$n, "\n")
```

### EXAMPLE 9: FRAMEWORK CONVERSION DEMONSTRATION

```{r ex9}
# Demonstrate framework conversions for SEM path coefficients

path_coefficients <- c(0.20, 0.30, 0.40)  # Partial correlations

cat("Framework conversions for SEM path coefficients:\n")
for (r in path_coefficients) {
  result <- sem_direct_effects_power(r_partial = r, power = 0.8, n_predictors = 4)
  cat("Input r =", r, ": d =", round(result$effect_size_conversions$cohens_d, 3), 
      ", R² =", round(result$effect_size_conversions$r_squared, 3), 
      ", Required n =", result$n, "\n")
}
```

### EXAMPLE 10: CROSS-METHOD FRAMEWORK CONSISTENCY

```{r ex10}
# Compare SEM direct effect with equivalent linear regression concept

path_effect <- 0.25
n_predictors_model <- 4

# SEM analysis (accounts for measurement error and structural complexity)
sem_result <- sem_direct_effects_power(r_partial = path_effect, power = 0.8, 
                                       n_predictors = n_predictors_model)

cat("SEM analysis for path coefficient r = 0.25, 4 predictors:\n")
cat("Required sample size:", sem_result$n, "participants\n")
cat("Effective sample size:", sem_result$effective_n, "participants\n")
cat("Note: SEM accounts for measurement error and structural complexity\n")
```

### EXAMPLE 11: LITERATURE INTEGRATION WORKFLOW

```{r ex11}
# Step 1: Literature review with mixed effect sizes

literature_effects <- data.frame(
  Study = c("A", "B", "C"),
  Effect = c(0.25, 0.4, 0.15),  # r, Cohen's d, f²
  Type = c("r", "d", "f2"),
  N_predictors = c(3, 4, 5)
)

# Step 2: Convert to framework partial correlations using effect_input parameter
framework_results <- list()
for (i in 1:nrow(literature_effects)) {
  framework_results[[i]] <- sem_direct_effects_power(
    effect_input = literature_effects$Effect[i], 
    effect_type = literature_effects$Type[i],
    power = 0.8,
    n_predictors = literature_effects$N_predictors[i]
  )
}

# Step 3: Meta-analytic planning
framework_rs <- sapply(framework_results, function(x) x$r_partial)
meta_r <- mean(framework_rs)
meta_predictors <- round(mean(literature_effects$N_predictors))
meta_result <- sem_direct_effects_power(r_partial = meta_r, power = 0.8, 
                                        n_predictors = meta_predictors)

cat("Literature integration: Meta r =", round(meta_r, 3),
    ", Required n =", meta_result$n, "(", meta_predictors, "pred.)\n")
```

## FRAMEWORK BEST PRACTICES

- SEM path coefficients ARE partial correlations - enables direct framework integration
- Use sem_direct_effects_framework_power() for automatic effect size conversion
- Larger sample sizes needed vs. linear regression due to structural complexity
- Measurement reliability crucial for stable path coefficient estimation
- Framework enables comparison of SEM results with regression/correlation analyses
